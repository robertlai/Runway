// Generated by CoffeeScript 1.9.3
var app;

app = angular.module('workspaceApp', []);

app.controller('workspaceController', function($scope) {});

app.controller('messagesController', function($scope, $http, $interval) {
  var fetchInitialMessages, fetchNewMessages, lastMessageId;
  $scope.chatVisible = true;
  $scope.newCommentNotValide = false;
  lastMessageId = -1;
  $scope.messages = [];
  fetchNewMessages = function() {
    return $http.get('/api/message?lastMessageId=' + lastMessageId).success(function(message) {
      lastMessageId = message.timestamp;
      return $scope.messages.push(message);
    });
  };
  $scope.hideChat = function() {
    $scope.chatVisible = false;
    return document.getElementById('dropzone').style.width = '100%';
  };
  $scope.showChat = function() {
    $scope.chatVisible = true;
    return document.getElementById('dropzone').style.width = '75%';
  };
  $scope.addComment = function() {
    if ($scope.newComment.trim().length > 0) {
      return $http.post('/api/message?user=Test User&content=' + $scope.newComment).then(function() {
        $scope.newComment = '';
        return $scope.newCommentNotValide = false;
      });
    }
  };
  fetchInitialMessages = function() {
    return $http.get('/api/messages').success(function(messages) {
      var i, len, message;
      for (i = 0, len = messages.length; i < len; i++) {
        message = messages[i];
        if (message.timestamp > lastMessageId) {
          lastMessageId = message.timestamp;
        }
      }
      return $scope.messages = messages;
    });
  };
  return fetchInitialMessages().then(function() {
    return $interval(fetchNewMessages, 500);
  });
});

// Generated by CoffeeScript 1.9.3
var app, scrollAtBottom, scrollToBottom, updateScrollState;

app = angular.module('workspaceApp', []);

scrollAtBottom = true;

app.controller('workspaceController', function($scope) {});

app.controller('messagesController', function($scope, $http) {
  var socket;
  socket = io();
  socket.on('initialMessages', function(messages) {
    $scope.messages = messages;
    return $scope.$apply();
  });
  socket.on('newMessage', function(message) {
    $scope.messages.push(message);
    return $scope.$apply();
  });
  socket.on('removeMessage', function(timestamp) {
    var i, j, len, message, ref;
    i = 0;
    ref = $scope.messages;
    for (j = 0, len = ref.length; j < len; j++) {
      message = ref[j];
      if (message.timestamp === timestamp) {
        $scope.messages.splice(i, 1);
        break;
      }
      i++;
    }
    return $scope.$apply();
  });
  $scope.chatVisible = true;
  $scope.newMessageNotValide = false;
  $scope.messages = [];
  $scope.sendMessage = function() {
    var message;
    if ($scope.newMessage.trim().length > 0) {
      $scope.newMessageNotValide = false;
      message = {
        content: $scope.newMessage,
        user: $scope.username
      };
      socket.emit('newMessage', message);
      return $scope.newMessage = '';
    }
  };
  $scope.removeMessage = function(timestamp) {
    return socket.emit('removeMessage', timestamp);
  };
  $scope.hideChat = function() {
    $scope.chatVisible = false;
    return document.getElementById('dropzone').style.width = '100%';
  };
  return $scope.showChat = function() {
    $scope.chatVisible = true;
    return document.getElementById('dropzone').style.width = '75%';
  };
});

window.onload = function() {
  var i, msgpanel;
  msgpanel = document.getElementById("msgpanel");
  msgpanel.scrollTop = msgpanel.scrollHeight;
  return i = setInterval(scrollToBottom, 100);
};

updateScrollState = function() {
  return scrollAtBottom = msgpanel.scrollTop === (msgpanel.scrollHeight - msgpanel.offsetHeight);
};

scrollToBottom = function() {
  if (scrollAtBottom) {
    return msgpanel.scrollTop = msgpanel.scrollHeight;
  }
};

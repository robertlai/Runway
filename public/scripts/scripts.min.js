!function e(r,t,o){function n(u,i){if(!t[u]){if(!r[u]){var a="function"==typeof require&&require;if(!i&&a)return a(u,!0);if(s)return s(u,!0);throw new Error("Cannot find module '"+u+"'")}var l=t[u]={exports:{}};r[u][0].call(l.exports,function(e){var t=r[u][1][e];return n(t?t:e)},l,l.exports,e,r,t,o)}return t[u].exports}for(var s="function"==typeof require&&require,u=0;u<o.length;u++)n(o[u]);return n}({1:[function(e,r,t){angular.module("runwayApp").constant("Constants",{OWNED_GROUP:"owned",JOINED_GROUP:"joined",DEFAULT_GROUP_COLOUR:"#0099CC",Messages:{SERVER_ERROR:"Server Error.  Please contact support.",GROUP_ALREADY_EXISTS:"This group already exists.",NO_OWNED_GROUPS:"You have no groups. Create one!",NO_JOINED_GROUPS:"You have not been added to any groups.",NO_GROUP_NAME_PROVIDED:"Please provide a group name.",USER_ALREADY_IN_GROUP:"This user has already been added to this group.",MUST_BE_OWNER_TO_DELETE:"You must be the owner of a group in order to delte it.",CONFIRM_GROUP_DELETE_1:"Are you sure you and to delete this group?\nAll members will be removed and all content destroyed.\nThere is no going back!",CONFIRM_GROUP_DELETE_2:"Last chance.  Are you 100% sure you want to do this?"}})},{}],2:[function(e,r,t){angular.module("runwayApp").controller("loginController",["$scope","$state","$stateParams","AuthService",function(e,r,t,o){return o.logout(),e.login=function(){return e.disableLogin=!0,e.error=!1,o.login(e.loginForm.username,e.loginForm.password).then(function(){return t.stateName?r.go(t.stateName,JSON.parse(t.stateParams)):r.go("home.groups"),e.loginForm={}})["catch"](function(r){return e.disableLogin=!1,e.error=r,e.loginForm={}})}}]).controller("navBarController",["$scope","$state","AuthService",function(e,r,t){return e.username=t.getUser().username,e.logout=function(){return t.logout().then(function(){return r.go("login")})}}]).controller("settingsController",["$scope","$state","AuthService",function(e,r,t){var o;return o=t.getUser()}]).controller("registerController",["$scope","$state","AuthService",function(e,r,t){return t.logout(),e.register=function(){return e.disableRegister=!0,e.error=!1,t.register(e.registerForm).then(function(){return r.go("login"),e.registerForm={}})["catch"](function(r){return e.disableRegister=!1,e.error=r,e.registerForm={}})}}]).controller("groupsController",["$scope","$uibModal","$stateParams","groupService",function(e,r,t,o){return e.groups=[],e.groupType=t.groupType,o.getGroups(t.groupType).then(function(r){return e.groups=r})["catch"](function(r){return e.error=r}),e.openEditGroupPropertiesModal=function(t,o){var n;return t.stopPropagation(),n=r.open({animation:!0,resolve:{editingGroup:o},templateUrl:"/partials/editGroupPropertiesModal",controller:"editGroupPropertiesModalController"}),n.result.then(function(r,t){var o,n,s,u,i;for(null==t&&(t=!1),e.error=null,i=e.groups,s=n=0,u=i.length;u>n;s=++n)if(o=i[s],o._id===r._id){t?e.groups.splice(s,1):e.groups[s]=r;break}})},e.openEditGroupMembersModal=function(t,o){var n;return t.stopPropagation(),n=r.open({animation:!0,size:"lg",resolve:{editingGroup:o},templateUrl:"/partials/editGroupMembersModal",controller:"editGroupMembersModalController"}),n.result.then(function(r){var t,o,n,s,u;for(console.log(r),u=e.groups,n=o=0,s=u.length;s>o;n=++o)if(t=u[n],t._id===r._id){e.groups[n]=r;break}})},e.openAddGroupModal=function(){var t;return t=r.open({animation:!0,templateUrl:"/partials/addGroupModal",controller:"addGroupModalController"}),t.result.then(function(r){return e.error=null,e.groups.push(r)})}}]).controller("addGroupModalController",["$scope","$uibModalInstance","groupService","Constants",function(e,r,t,o){return e.newGroup={name:"",description:"",colour:o.DEFAULT_GROUP_COLOUR},e.addGroup=function(){return e.disableModal=!0,t.addGroup(e.newGroup).then(function(e){return r.close(e)})["catch"](function(r){return e.disableModal=!1,e.error=r})},e.cancel=function(){return r.dismiss()}}]).controller("editGroupPropertiesModalController",["$scope","$uibModalInstance","groupService","editingGroup","Constants",function(e,r,t,o,n){return e.editingGroup=angular.copy(o),e.editGroup=function(){return e.disableModal=!0,t.editGroup(e.editingGroup).then(function(e){return r.close(e)})["catch"](function(r){return e.disableModal=!1,e.error=r})},e["delete"]=function(){return e.disableModal=!0,confirm(n.Messages.CONFIRM_GROUP_DELETE_1)&&confirm(n.Messages.CONFIRM_GROUP_DELETE_2)?t.deleteGroup(e.editingGroup).then(function(){return r.close(e.editingGroup,!0)})["catch"](function(r){return e.disableModal=!1,e.error=r}):e.disableModal=!1},e.cancel=function(){return r.dismiss()}}]).controller("editGroupMembersModalController",["$scope","$http","$uibModalInstance","AuthService","groupService","userService","editingGroup",function(e,r,t,o,n,s,u){return e.owner=o.getUser(),e.editingGroup=angular.copy(u),e.getUsers=function(r){return s.getUsers(r).then(function(e){return e})["catch"](function(r){return e.error=r})},e.addMember=function(){return e.disableModal=!0,n.addMember(e.editingGroup._id,e.memberToAdd).then(function(){return e.disableModal=!1,e.editingGroup._members.push(e.memberToAdd),e.memberToAdd=null})["catch"](function(r){return e.disableModal=!1,e.error=r})},e.deleteMember=function(e){return console.log("deleting",e)},e.getMemberDisplay=function(e){return e?e.username+" ("+e.firstName+" "+e.lastName+")":""},e.close=function(){return t.close(e.editingGroup)}}]).controller("workspaceController",["$scope","$state","$stateParams","AuthService",function(e,r,t,o){var n,s,u,i,a,l,c,p,d,g,f;return n=$("#dropzone"),p=void 0,d=void 0,l=function(){return n.outerWidth()},c=function(){return n.outerHeight()},g=new Dropzone("#dropzone",{url:"/api/fileUpload",method:"post",uploadMultiple:!1,maxFilesize:9,clickable:!1,createImageThumbnails:!1,autoProcessQueue:!0,acceptedFiles:"image/*, application/pdf",accept:function(r,t){return this.options.url="/api/fileUpload?_group="+e.group._id+"&x="+100*p/l()+"&y="+100*d/c(),u(),t()}}),g.on("complete",function(e){return g.removeFile(e)}),f=io(),f.on("setGroup",function(r){return e.group=r}),f.on("notAllowed",function(){return r.go("home.groups")}),s=function(r,t){var o,n;return e.$apply(),o=document.getElementById("chatBody"),n=t||Math.abs(o.scrollTop-o.scrollHeight+o.offsetHeight)<50,r(),e.messagesLoading=!1,e.$apply(),n?o.scrollTop=o.scrollHeight:void 0},f.on("initialMessages",function(r){return s(function(){return e.messages=r},!0)}),f.on("moreMessages",function(r){var t;return e.allMessagesLoaded=0===r.length,t=document.getElementById("chatBody"),t.scrollTop=1,s(function(){return e.messages=e.messages.concat(r)}),t.scrollTop=t.scrollHeight-e.preLoadScrollHeight}),f.on("newMessage",function(r){return s(function(){return e.messages.push(r)})}),f.on("removeMessage",function(r){var t,o,n,s,u;for(u=e.messages,o=t=0,n=u.length;n>t;o=++t)if(s=u[o],s._id===r){e.messages.splice(o,1);break}return e.$apply()}),f.on("updateItem",function(e){return $("#"+e._id).offset({top:e.y/100*c(),left:e.x/100*l()})}),f.on("newItem",function(e){var r;return r=void 0,"text"===e.type?r=$("<p/>",{"class":"noselect"}).text(e.text):"image"===e.type.substring(0,5)?r=$("<img/>",{src:"/api/file?_file="+e._id}):"application/pdf"===e.type&&(r=$('<div style="padding-top:25px; background-color:black;"><object data="/api/file?_file='+e._id+"'/></div>")),r?r.css("position","absolute").attr("id",e._id).offset({top:e.y/100*c(),left:e.x/100*l()}).appendTo(n).draggable({containment:"parent",stop:function(r,t){return f.emit("updateItemLocation",e._id,100*t.offset.left/l(),100*t.offset.top/c())}}):void 0}),e.addMessageToWorkspace=function(r){var t;return t={text:r},$.ajax({method:"POST",url:"/api/text?_group="+e.group._id,data:JSON.stringify(t),processData:!1,contentType:"application/json; charset=utf-8"})},i=function(){return $("#dropzone").addClass("dropzoneHover"),$("#dndText").text("Drop to upload")},u=function(){return $("#dropzone").removeClass("dropzoneHover"),$("#dndText").text("Drag and drop files here")},n.on("dragover",function(e){return p=e.originalEvent.offsetX,d=e.originalEvent.offsetY,i()}),n.on("dragleave",function(e){return u()}),e.chatVisible=!0,e.messages=[],e.sendMessage=function(){return e.newMessage&&e.newMessage.trim().length>0?(f.emit("postNewMessage",e.newMessage),e.newMessage=""):void 0},e.removeMessage=function(e){return f.emit("postRemoveMessage",e)},$("#chatBody").on("scroll",function(r){var t;return t=document.getElementById("chatBody"),e.allMessagesLoaded||0!==t.scrollTop?void 0:(e.messagesLoading=!0,e.$apply(),e.preLoadScrollHeight=t.scrollHeight,f.emit("getMoreMessages",e.messages[e.messages.length-1].date))}),(a=function(){return e.messagesLoading=!0,e.user=o.getUser(),f.emit("groupConnect",e.user,t.groupId)})()}])},{}],3:[function(e,r,t){var o;o=angular.module("runwayApp",["ui.router","ui.router.title","ui.bootstrap","color.picker"]),e("./services.coffee"),e("./controllers.coffee"),e("./constants.coffee"),o.config(["$stateProvider","$urlRouterProvider","$locationProvider","Constants",function(e,r,t,o){return t.html5Mode({enabled:!0}),r.otherwise("/home/groups/"+o.OWNED_GROUP),e.state("login",{url:"/login?stateName&stateParams",resolve:{$title:function(){return"Login"}},authenticated:!1,views:{"content@":{templateUrl:"/partials/login",controller:"loginController"}}}).state("register",{url:"/register",resolve:{$title:function(){return"Register"}},authenticated:!1,views:{"content@":{templateUrl:"/partials/register",controller:"registerController"}}}).state("home",{"abstract":!0,url:"/home",replace:!0,views:{"navBar@":{replace:!0,templateUrl:"/partials/navBar",controller:"navBarController"},"content@":{template:'<div ui-view class="homeUiView"></div>'}}}).state("home.settings",{"abstract":!0,url:"/settings",replace:!0,resolve:{$title:function(){return"Account Setting"}},templateUrl:"/partials/settings",controller:"settingsController"}).state("home.settings.general",{url:"/general",authenticated:!0,templateUrl:"/partials/settings-general"}).state("home.settings.security",{url:"/security",authenticated:!0,templateUrl:"/partials/settings-security"}).state("home.groups",{url:"/groups/:groupType",params:{groupType:o.OWNED_GROUP},resolve:{$title:function(){return"Groups"}},authenticated:!0,templateUrl:"/partials/groups",controller:"groupsController"}).state("workspace",{url:"/workspace/:groupId",params:{groupId:"groupId"},resolve:{$title:function(){return"Workspace"}},authenticated:!0,views:{"content@":{templateUrl:"/partials/workspace",controller:"workspaceController"}}})}]).run(["$rootScope","$state","AuthService",function(e,r,t){return e.$on("$stateChangeStart",function(e,o,n){return o.authenticated?t.loggedIn()["catch"](function(e){return r.go("login",{stateName:o.name,stateParams:JSON.stringify(n)})}):void 0})}])},{"./constants.coffee":1,"./controllers.coffee":2,"./services.coffee":4}],4:[function(e,r,t){angular.module("runwayApp").factory("AuthService",["$q","$http",function(e,r){var t,o,n,s,u,i;return i=null,t=function(){return i},o=function(){var t;return t=e.defer(),r.post("/getUserStatus").success(function(e){return o=e.loggedIn,o?(i=e.user,t.resolve()):(i=null,t.reject())}).error(function(e){return i=null,t.reject()}),t.promise},n=function(t,o){var n;return n=e.defer(),r.post("/login",{username:t,password:o}).success(function(e,r){return 200===r&&e.status?(i=e.user,n.resolve()):(i=null,n.reject(e.error))}).error(function(e){return i=null,n.reject(e.error)}),n.promise},s=function(){var t;return t=e.defer(),r.get("/logout").success(function(e){return i=null,t.resolve()}).error(function(e){return i=null,t.reject()}),t.promise},u=function(t){var o;return o=e.defer(),r.post("/register",t).success(function(e,r){return 200===r&&e.status?o.resolve():o.reject(e.error)}).error(function(e){return o.reject(e.error)}),o.promise},o(),{getUser:t,loggedIn:o,login:n,logout:s,register:u}}]).factory("groupService",["$http","$q","Constants",function(e,r,t){var o,n,s,u,i;return i=function(o){var n;return n=r.defer(),e.get("/api/groups/"+o).success(function(e){return e.length>0?n.resolve(e):o===t.OWNED_GROUP?n.reject(t.Messages.NO_OWNED_GROUPS):o===t.JOINED_GROUP?n.reject(t.Messages.NO_JOINED_GROUPS):void 0}).error(function(e){return n.reject(t.Messages.SERVER_ERROR)}),n.promise},o=function(o){var n;return n=r.defer(),o&&o.name.trim().length>0?e.post("/api/newGroup",o).success(function(e){return n.resolve(e)}).error(function(e,r){return 409===r?n.reject(t.Messages.GROUP_ALREADY_EXISTS):n.reject(t.Messages.SERVER_ERROR)}):n.reject(t.Messages.NO_GROUP_NAME_PROVIDED),n.promise},u=function(o){var n;return n=r.defer(),o&&o.name.trim().length>0?e.post("/api/editGroup",o).success(function(e){return n.resolve(e)}).error(function(e,r){return 409===r?n.reject(t.Messages.GROUP_ALREADY_EXISTS):n.reject(t.Messages.SERVER_ERROR)}):n.reject(t.Messages.NO_GROUP_NAME_PROVIDED),n.promise},n=function(o,n){var s;return s=r.defer(),e.post("/api/addGroupMember",{_group:o,memberToAdd:n}).success(function(){return s.resolve()}).error(function(e,r){return 409===r?s.reject(t.Messages.USER_ALREADY_IN_GROUP):s.reject(t.Messages.SERVER_ERROR)}),s.promise},s=function(o){var n;return n=r.defer(),e.post("/api/deleteGroup",o).success(function(){return n.resolve()}).error(function(e,r){return 401===r?n.reject(t.Messages.MUST_BE_OWNER_TO_DELETE):n.reject(t.Messages.SERVER_ERROR)}),n.promise},{getGroups:i,addGroup:o,editGroup:u,deleteGroup:s,addMember:n}}]).factory("userService",["$http","$q","Constants",function(e,r,t){var o;return o=function(o){var n;return n=r.defer(),e.post("/api/getUsers",{query:o}).success(function(e){return n.resolve(e)}).error(function(e){return n.reject(t.Messages.SERVER_ERROR)}),n.promise},{getUsers:o}}])},{}]},{},[3]);
// Generated by CoffeeScript 1.10.0
(function() {
  var express;

  express = require('express');

  module.exports = function(passport) {
    var pageRouter, partialRouter;
    pageRouter = express.Router();
    partialRouter = require('./partialRouter')();
    pageRouter.use('/partials', partialRouter);
    pageRouter.post('/login', function(req, res, next) {
      return passport.authenticate('login', function(err, user, message) {
        if (err != null) {
          return res.sendStatus(500).json({
            err: err
          });
        } else if (!user) {
          return res.sendStatus(401).json({
            err: message
          });
        } else {
          return req.logIn(user, function(err) {
            if (err != null) {
              return res.sendStatus(500).json({
                err: err
              });
            } else {
              return res.sendStatus(200).json({
                status: 'Login successful!'
              });
            }
          });
        }
      })(req, res, next);
    });
    pageRouter.post('/register', function(req, res, next) {
      return passport.authenticate('register', function(err, user, message) {
        if (err != null) {
          return res.sendStatus(500).json({
            err: err
          });
        } else if (!user) {
          return res.sendStatus(409).json({
            err: message
          });
        } else {
          return res.sendStatus(200).json({
            status: 'Registration successful!'
          });
        }
      })(res, res, next);
    });
    pageRouter.get('/logout', function(req, res) {
      req.logout();
      return res.sendStatus(200).json({
        status: 'Bye!'
      });
    });
    pageRouter.get('/', function(req, res) {
      return res.render('index');
    });
    return pageRouter;
  };

}).call(this);
